apiVersion: resource.k8s.io/v1
kind: ResourceClaim
metadata:
  name: dynamic-interface-pbr-1
spec:
  devices:
    requests:
    - name: req-veth
      exactly:
        deviceClassName: dra.net
        selectors:
          - cel:
              expression: device.attributes["dra.net/ifName"].string == "pbr-test-pod-1"
    config:
    - opaque:
        driver: dra.net
        parameters:
          interface:
            name: "eth1"
            addresses:
            - "192.168.100.10/24"
          rules:
          - source: "192.168.100.10/32"
            table: 100
            priority: 32000
          routes:
          - destination: "192.168.100.0/24"
            scope: 253
            table: 100
          - destination: "0.0.0.0/0"
            gateway: "192.168.100.1"
            table: 100
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-pbr-1
  labels:
    app: pod-pbr-1
spec:
  containers:
  - name: ctr1
    image: registry.k8s.io/e2e-test-images/agnhost:2.54
    command: ["/agnhost", "netexec", "--http-port=8080"]
  resourceClaims:
  - name: pbr1
    resourceClaimName: dynamic-interface-pbr-1
---
apiVersion: resource.k8s.io/v1
kind: ResourceClaim
metadata:
  name: dynamic-interface-pbr-2
spec:
  devices:
    requests:
    - name: req-veth
      exactly:
        deviceClassName: dra.net
        selectors:
          - cel:
              expression: device.attributes["dra.net/ifName"].string == "pbr-test-pod-2"
    config:
    - opaque:
        driver: dra.net
        parameters:
          interface:
            name: "eth1"
            addresses:
            - "192.168.200.10/24"
          rules:
          - source: "192.168.200.10/32"
            table: 100
            priority: 32000
          routes:
          - destination: "192.168.200.0/24"
            scope: 253
            table: 100
          - destination: "0.0.0.0/0"
            gateway: "192.168.200.1"
            table: 100
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-pbr-2
  labels:
    app: pod-pbr-2
spec:
  containers:
  - name: ctr1
    image: registry.k8s.io/e2e-test-images/agnhost:2.54
    command: ["/agnhost", "netexec", "--http-port=8080"]
  resourceClaims:
  - name: pbr2
    resourceClaimName: dynamic-interface-pbr-2
