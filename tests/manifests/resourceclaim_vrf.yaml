apiVersion: resource.k8s.io/v1
kind: ResourceClaim
metadata:
  name: dynamic-interface-vrf-1
spec:
  devices:
    requests:
    - name: req-veth
      exactly:
        deviceClassName: dra.net
        selectors:
          - cel:
              expression: device.attributes["dra.net/ifName"].string == "vrf-test-pod-1"
    config:
    - opaque:
        driver: dra.net
        parameters:
          interface:
            name: "eth1"
            addresses:
            - "10.10.10.2/24"
            vrf: true
          routes:
          - destination: "0.0.0.0/0"
            gateway: "10.10.10.1"
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-vrf-1
  labels:
    app: pod-vrf-1
spec:
  containers:
  - name: ctr1
    image: registry.k8s.io/e2e-test-images/agnhost:2.54
    command: ["/agnhost", "netexec", "--http-port=8080"]
  resourceClaims:
  - name: vrf1
    resourceClaimName: dynamic-interface-vrf-1
---
apiVersion: resource.k8s.io/v1
kind: ResourceClaim
metadata:
  name: dynamic-interface-vrf-2
spec:
  devices:
    requests:
    - name: req-veth
      exactly:
        deviceClassName: dra.net
        selectors:
          - cel:
              expression: device.attributes["dra.net/ifName"].string == "vrf-test-pod-2"
    config:
    - opaque:
        driver: dra.net
        parameters:
          interface:
            name: "eth1"
            addresses:
            - "10.10.20.2/24"
            vrf: true
          routes:
          - destination: "0.0.0.0/0"
            gateway: "10.10.20.1"
---
apiVersion: v1
kind: Pod
metadata:
  name: pod-vrf-2
  labels:
    app: pod-vrf-2
spec:
  containers:
  - name: ctr1
    image: registry.k8s.io/e2e-test-images/agnhost:2.54
    command: ["/agnhost", "netexec", "--http-port=8080"]
  resourceClaims:
  - name: vrf2
    resourceClaimName: dynamic-interface-vrf-2
